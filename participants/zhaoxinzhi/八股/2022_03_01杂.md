## 一、写在前面

杂。

## 二、问题

### 1、websocket和http

websocket是一种双向通信协议，通过重用已建立的连接通道将数据从客户端发送到服务器，或者从服务器发送到客户端。连接保持活动状态，直到被客户端或服务器终止。

几乎所有的实时应用程序（如（交易，监视，通知）服务）。都使用websocket在单个通信通道上接收数据。

所有经常更新的应用程序都可以使用websocket。（游戏，即时聊天室，即时web应用程序）

http是一种单向协议。

如果只是想请求资源等一次性的需求，而不是需要保留连接的，就可以使用http。

### 2、一次TCP连接的最多能传4G数据？

不是的，seq主要是为了解决数据包排序的问题，seq的连续性可以保证tcp能把收到乱序的报文重新排列成原来的顺序。

seq达到4G上限后重新开始计数，只要tcp知道后续这个小seq的包是排在4G这个后面的就ok。（这一步通常是通过TCP时间戳来知道的）

只有在传输中的一方不支持RFC1323标准TCP时间戳的情况下才有可能发生只能传输4G的情况。而绝大多数操作系统里这个功能是默认开启的，所以不会发生。

### 3、MySQL的InnoDB引擎的B+树叶子结点是什么链表连接？

答案是双向链表。

### 4、关于MySQL的倒排索引

倒排索引是实现“单词-文档矩阵”的一种具体存储形式，通过倒排索引，可以根据单词快速获取包含这个单词的文档列表。倒排索引主要由两个部分组成：“单词词典”和“倒排文件”。

比如搜索引擎在搜索文档的场景：

一般数据库中存的是：

[文档ID1，[关键词1，关键词2...]

[文档ID2，[关键词1，关键词2...]

但是当用户在主页上搜索关键词“华为手机”时，假设只存在正向索引（forward index），那么就需要扫描索引库中的所有文档，找出所有包含关键词“华为手机”的文档，再根据打分模型进行打分，排出名次后呈现给用户。因为互联网上收录在搜索引擎中的文档的数目是个天文数字，这样的索引结构根本无法满足实时返回排名结果的要求。

​    **所以，搜索引擎会将正向索引重新构建为倒排索引**，即把文件ID对应到关键词的映射转换为**关键词到文件ID的映射**，每个关键词都对应着一系列的文件，这些文件中都出现这个关键词。

倒排索引结构如下：

[关键词1，[文档1，文档2,.....]]

[关键词2，[文档1，文档2,.....]]

### 5、MySQL依赖什么实现MVCC？

MVCC在MySQL中实现所依赖的手段主要是:"**undo log和read view**"。

- undo log :undo log 用于记录某行数据的多个版本的数据。
- read view :用来判断当前版本数据的可见性

### 6、在并发量很大的时候如何修改表结构？

场景：系统运行一段时间，数据量已经很大，这时候系统升级，有张表A需要增加个字段，并发量白天晚上都很大，请问怎么修改表结构。

修改表结构会导致表锁,数据量大修改数据很长，导致大量用户阻塞，无法访问！

所以做法是：

1. 首先创建一个和你要执行的alter操作的表一样的空的表结构。

2. 执行我们赋予的表结构的修改，然后copy原表中的数据到新表里面。

3. 在原表上创建一个触发器在数据copy的过程中，将原表的更新数据的操作全部更新到新的表中来。

4. copy完成之后，用rename table 新表代替原表，默认删除原表。

### 7、MySQL的隔离级别针对改操作吗？

不针对，只针对select读操作。

### 8、在各种隔离级别下是如何加锁的？

Read Uncommitted级别下，读取数据不需要加共享锁，这样就不会跟被修改的数据上的排他锁冲突
Read Committed级别下，读操作需要加共享锁，但是在语句执行完以后释放共享锁；
Repeatable Read级别下，读操作需要加共享锁，但是在事务提交之前并不释放共享锁，也就是必须等待事务执行完毕以后才释放共享锁。

> ~~注意这两种级别的读都特指“**当前读**”，即select ... for update那种，因为快照读是通过MVCC无锁实现的。~~
>
> emmm其实我觉得Read Committed和Repeatable Read这里说的都不对，因为读操作是加共享锁还是排他锁是通过select for update还是 select in share mode来手动控制的，不是数据库实现的。

SERIALIZABLE 是限制性最强的隔离级别，因为该级别锁定整个范围的键，并一直持有锁，直到事务完成。

### 9、一个事务的更新覆盖了其它事务的更新结果，解决上述更新丢失的方式有哪些？

> 之前整理过

1、串行化的隔离方式

2、乐观锁

3、悲观锁

### 10、如果已经建立了TCP连接，但是客户端突然出现故障了怎么办？

TCP还设有一个保活计时器，显然，客户端如果出现故障，服务器不能一直等下去，白白浪费资源。服务器每收到一次客户端的请求后都会重新复位这个计时器，时间通常是设置为2小时，若两小时还没有收到客户端的任何数据，服务器就会发送一个探测报文段，以后每隔75秒钟发送一次。若一连发送10个探测报文仍然没反应，服务器就认为客户端出了故障，接着就关闭连接。