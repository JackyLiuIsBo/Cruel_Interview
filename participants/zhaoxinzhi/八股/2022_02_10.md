## 一、写在前面

说到HTTP，我们可以给面试官聊些什么。

## 二、HTTP

> 参考链接：https://zhuanlan.zhihu.com/p/342311013

### 1、HTTP 的瓶颈

影响一个 HTTP 网络请求的因素主要有两个：**带宽和延迟**。

首先来说一下带宽，如果我们还停留在拨号上网阶段的话，带宽很容易出现瓶颈，因为单位时间内传输的数据量很小。但是现在随着光纤等通信技术的不断发展，10Mbps、100Mbps、甚至 1000 Mbps 进入了每个家庭，我们不用再担心带宽成为网络请求的瓶颈了。

延迟主要有下面三个方面：

- 浏览器阻塞（HOL blocking）：浏览器会因为一些原因阻塞请求。浏览器对于同一个域名，同时只能有 4 个连接（这个根据浏览器内核不同可能会有所差异），超过浏览器最大连接数限制，后续请求就会被阻塞。
- DNS 查询（DNS Lookup）：浏览器需要知道目标服务器的 IP 才能建立连接。将域名解析为 IP 的这个系统就是 DNS。这个通常可以利用 DNS 缓存结果来达到减少这个时间的目的。
- 建立连接（Initial connection）：HTTP 是基于 TCP 协议的，浏览器最快也要在第三次握手时才能捎带 HTTP 请求报文，达到真正的建立连接，但是这些连接无法复用会导致每次请求都经历三次握手和慢启动。三次握手在高延迟的场景下影响较明显，慢启动则对文件类大请求影响较大。

### 2、HTTP1.0的痛点

- HTTP 1.0 有一个被抱怨最多的是**连接无法复用**，当每次有新的请求时都会重新经历一次三次握手和四次挥手过程，并且连接的建立和释放需要耗费大量的服务器资源，在请求少的页面还尚能应对，不过随着请求的不断增多，HTTP1.0 越来越难顶。

- HTTP 还有一个被抱怨最多的问题就是它的**队头阻塞(head of blocking)**，队头阻塞问题会导致带宽无法充分利用，导致后续的请求被阻塞。

### 3、HTTP的发展过程中，如何解决队头阻塞的

HTTP1.1中提出了流水线设计（**pipelining**），但是缺陷也很多：

- 因为只有幂等的请求比如 GET、HEAD 才能使用 pipelining ，非幂等请求比如 POST 则不能使用，因为**请求之间可能存在先后依赖关系**。
- 其实队头阻塞问题并没有完全解决，因为服务器返回的响应还是要依次返回，也就是返回的请求时 FIFO - 先发先回。
- 绝大多数 HTTP 代理服务器不支持 pipelining。
- 和不支持 pipelining 的老服务器协商有问题。

谷歌研发的SPDY：

### 4、研发HTTP 2.0，有哪些前提

HTTP 2.0 在设计之初就有一些重要的前提：

- 客户端向服务器发送请求的这种基本模型不会改变。
- 原有的协议头不会改变，使用 http:// 和 https:// 的服务和应用不会做任何修改，不会有 http2://。
- 使用 HTTP 1.x 的客户端和服务器可以平滑升级到 HTTP 2.0 上。
- 不识别 HTTP 2.0 的代理服务器可以将请求降级到 HTTP 1.x。

客户端在和服务器确定是使用 HTTP1.x 还是 HTTP 2.0 之前，需要先确定对方是否支持 HTTP 2.0，所以这里必须要先进行协商，也就是客户端询问服务器，这样一来一回就多了一个 RTT 的延迟。我们对 HTTP 1.x 的修改就是为了降低延迟，现在又多了一个 RTT，这样显然是无法接受的。不过经过讨论后，最终 HTTP 2.0 没有强制要走 SSL 层。

### 5、HTTP 2.0的主要变化

#### 多路复用

多路复用允许**同时**通过单一的 HTTP/2 连接发起多重的请求-响应消息。

在 HTTP/1.1 协议中 「浏览器客户端在同一时间，针对同一域名下的请求有一定数量限制。超过限制数目的请求会被阻塞」。比如Chrome允许与同一服务器的连接数为6.

> 这也是为何一些站点会有多个静态资源 CDN 域名的原因之一，拿 Twitter 为例，`http://twimg.com`目的就是变相的解决浏览器针对同一域名的请求限制阻塞问题。

<img src="D:\mystudy\internship\Cruel_Interview\participants\zhaoxinzhi\assets\2022_02_10\image-20220209224503965.png" alt="image-20220209224503965" style="zoom:50%;" />

因此 HTTP/2 可以很容易的去实现多流并行而不用依赖建立多个 TCP 连接，HTTP/2 把 HTTP 协议通信的基本单位缩小为一个一个的帧，这些帧对应着逻辑流中的消息。并行地在同一个 TCP 连接上 **双向交换**消息。

#### 二进制分帧



#### 首部压缩



#### 服务端推送



#### 给请求设置优先级

