## 一、写在前面

今天是关于**数据库索引**。

## 二、数据库索引

索引是一种数据结构，是用来快速定位记录的。

### 1、使用B树和B+树的比较

InnoDB的索引使用的是B+树实现，B+树对比B树的好处：

- IO次数少：B+树的中间结点只存放索引，数据都存在叶结点中，因此中间结点可以存更多的数据，让索引树更加矮胖；
- 范围查询效率更高：B树需要中序遍历整个树，只B+树需要遍历叶结点中的链表；
- 查询效率更加稳定：每次查询都需要从根结点到叶结点，路径长度相同，所以每次查询的效率都差不多

### 2、使用B树索引和哈希索引的比较

哈希索引能以 O(1) 时间进行查找，但是只支持精确查找，无法用于部分查找和范围查找，无法用于排序与分组；B树索引支持大于小于等于查找，范围查找。哈希索引遇到大量哈希值相等的情况后查找效率会降低。哈希索引不支持数据的排序。

### 3、使用索引的优点

- 大大加快了数据的**检索速度**；
- 可以显著减少查询中**分组和排序**的时间；
- 通过创建唯一性索引，可以保证数据库表中每一行数据的唯一性；
- 将随机 I/O 变为**顺序 I/O**（B+Tree 索引是有序的，会将相邻的数据都存储在一起）

缺点：建立和维护索引耗费时间空间，更新索引很慢。

### 4、哪些情况下索引会失效？

数据量小的时候，优化器会判定全表扫描效率更高，就不会使用索引

错误的使用索引：

- 以“%(表示任意0个或多个字符)”开头的LIKE语句；
- OR语句前后没有同时使用索引；
- 数据类型出现隐式转化（如varchar不加单引号的话可能会自动转换为int型）；
- 对于多列索引，必须满足 **最左匹配原则**/最左前缀原则 (最左优先，eg：多列索引col1、col2和col3，则 索引生效的情形包括 col1或col1，col2或col1，col2，col3)；
- 如果MySQL估计全表扫描比索引快，则不使用索引（比如非常小的表）

### 5、在哪些地方适合创建索引？（创建索引要考虑哪些因素？）

- 具有唯一性的列上
- 经常被查询的字段
  - 经常根据范围搜索的字段
  - 需要排序的列

- 经常用作表连接的字段；（因为这些列主要是作为外键）
- 经常出现在ORDER BY/GROUP BY/DISDINCT后面的字段

### 6、不适合建索引的场景？

- 表中数据不多
- 数据重复且分布平均的字段（比如性别，只可能=‘男’or‘女’）
- 频繁更新的字段
- 很少作为查询select使用的字段

如果字段添加了索引，那么在更新数据时，不仅仅要更新数据本身，还要维护其索引，如果频繁更新则会带来很多额外开销。因此如果需要对数据进行频繁的增删改，则不适合建索引。一般300~500W数据量可以考虑建索引。

> 记一些专业词：维护成本，额外开销。

### 7、MySQL索引从逻辑上看有哪些？

分为单列索引和组合索引。

单列索引分为主键索引，唯一索引，普通索引。

### 8、Explain字段

![image-20220227204506573](D:\mystudy\internship\Cruel_Interview\participants\zhaoxinzhi\assets\2022_01_25索引\image-20220227204506573.png)
