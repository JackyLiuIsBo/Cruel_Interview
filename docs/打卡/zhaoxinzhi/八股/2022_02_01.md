## 一、写在前面

今天给**mysql**收了尾。

## 二、MySQL

### 1、MySQL的权限管理

mysql的权限管理是在mysql.user表下。

每个用户都有全局的权限，和数据库级别的权限。（即可以对仅某数据库单独授权）

```sql
-- 创建用户
create user myname identified by '123456'

-- 修改当前用户的密码
set password = PASSWORD('111111')
-- 修改某用户的密码
set password for 用户名 = PASSWORD('111111')

-- 重命名name1为name2
rename user name1 to name2

-- 用户授权（如果不是DBA，可以不用记这么多权限）
-- all privileges 级别：除了给别人grant，其他权限都包括，。
grant all privileges on *.* to name2

-- 查询指定用户的权限
show grants for name2

-- 撤销权限
revoke 权限 on 库.表 from name2

-- 删除用户
drop user name2
```



### 2、数据库的备份

> 自己制作网站的时候，要设置，隔几个小时备份一下数据库

备份，其实就是导出一个`.sql`文件，可以设置导出结构（也就是表结构，create表的时候的东西），也可以设置导出数据（就是insert每一条记录），当然，也可以同时导出结构和数据。所以备份其实就是把当前表的状态转化成几个create和insert的sql语句序列。

在使用时可以导入，其实就是执行一遍里面sql语句。

#### 2.1 为什么要备份？

方便进行数据转移。

保证数据不丢失，用来容灾。

#### 2.2 如何备份？

可视化界面操作。

命令行：mysqldump机器命令。

其实备份的时候无非就是三个要素：选定 哪个数据库，选定 备份到哪个位置，选择 备份结构还是数据。

#### 2.3 作为常识

一般的，1W条数据占用空间1M。1000W条数据占用空间1G。

### 3、设计数据库表的几个套路

1、一般可以加一个全局配置表configs：用来存一些偶尔要用到的自定义的key-value值，比如博客当前版本号，博客title（注意哈不是文章title）。

2、善于用自连接做一些 需要层次化的记录。（比如回复评论等）

3、可以在表中多设计一个字段sort，用于自定义排序规则，比如友链表，我可以自定义排序规则

### 4、数据库范式

#### 4.1、为什么需要数据规范化？

不然会造成信息重复，插入异常（导致数据显示不完整），删除异常（会丢失有效信息，这个表中删除了这个数据，那个表没删除，比如文章删掉了标签还在） 

#### 4.2、第一范式

保证数据原子性。像是山东省济南市，细分的话其实山东省和济南市要分成两个字段，不然不满足第一范式。

#### 4.3、第二范式

> 保证每张表只描述一件事情。第二范式的目的是消除各个非主属性的部分函数依赖。保证任何非主属性都依赖于所有的主属性。

单一主键的表一定满足第二范式。

判断条件：如果该表是联合主键，并且有一些字段只依赖与联合主键中的其中一个候选码。

如何使表满足第二范式：第二范式表中每一列和主键需要满足一对一关系，因此如果出现一对多就要吧多的那部分分出去通过主键关联，例如用户和用户评论。

#### 4.4、第三范式

第三范式：在2NF的基础上消除传递依赖。保证任何非主属性不依赖于其他非主属性。即保证表中每一列数据都和主键直接相关而不是间接相关。

#### 4.5、总结

简单总结三大范式：1.原子性 2.消除非主属性对主属性的依赖 3.消除非主属性对非主属性的依赖。

所谓传递依赖：传递依赖就是a能到b，b能到c，从而a能到c。第三范式就是不能有这种关系。



#### 4.2、一定是越规范越好吗？

> 阿里规范：关联查询不得超过三张表。

规范性和性能的问题：

取得规范性高的同时，也牺牲了性能，比如一张表可以解决的事情，按照规范，需要拆成10张表，那关联查询的时候就需要join十个表。

比如一个用户信息，id name 省市区啥的。按照3nf标准，应该把省市区拿出去仅和name关联。所以反3nf。但是像省市区这种万年不变的，冗余下名称字段满足下3nf也不无不可。

有的时候会故意添加一些冗余字段，让多表查询变为单表查询

有的时候会故意添加一些计算列，比如查询总和，就不需要count聚合函数了（本质是将大数据量查询降低为小数据量查询），当然还有一种解决方式是加索引。

