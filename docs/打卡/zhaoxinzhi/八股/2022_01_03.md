## 一、写在前面

今天继续肝**计算机网络应用层**的知识。主要是把HTTPS建立连接的过程给彻底整明白了。还有关于SSL/TLS握手过程，这个视频讲的十分详细，推荐一下：https://www.bilibili.com/video/BV1KY411x7Jp



## 二、计算机网络

### 1、对称加密与非对称加密的区别及优缺点

- 对称加密
  - **对称加密是用相同的秘钥进行加密和通信**，即指的就是加、解密使用的同是一串密钥，所以被称做对称加密。对称加密只有一个密钥作为私钥。 常见的对称加密算法：DES，AES等。
  - 优点：加解密的效率要高得多、加密速度快。
  - 缺点：对于密钥的管理和分发上比较困难，安全性低，密钥管理负担很重。服务端和几个客户端保持连接就要保存几份私钥。
- 非对称加密
  - **非对称加密是用一个钥对**，即指的是加、解密使用不同的密钥，一把作为公开的公钥，另一把作为私钥。**非对称加密包含两种形式：公钥加密私钥解密、私钥加密公钥解密。**
  - 优点：安全性更高，不论服务端需要和多少客户端保持连接，都只需要保存自己的一份钥对。
  - 缺点：加密和解密花费时间长、速度慢，只适合对少量数据进行加密。

### 2、关于非对称加密的两种形式

首先明确一点：公钥和私钥，都能互相解密。（注意，私钥加密过的数据是可以由公钥解密的）

再说一个结论：私钥在谁那里，加密就用的谁的钥对。（下面每个例子都列出了每一步用到的钥匙是谁的，可以验证看看）

这部分内容以A给B发送数据包为例。

公钥加密私钥解密比较好理解，**一句话就是A发送的包只有B能解开**。虽然我A发送的包可以被所有人捕获，但可以保证信息只有B才可以解读。（A用的是B的公钥，B用的是B的私钥）

私钥加密公钥解密，**一句话就是只有A发送的包才能被B解开**。这里举两个例子：

​	1、用于签名验证，虽然所有人都有A的公钥，但只有A发送的包才可以被所有人解读，即保证了我作为B收到的肯定是A发送的包，而不是其他人发送的包。（A用的是A的私钥，B用的是A的公钥）

​	2、CA证书验证。如果你能用某把公钥解开了一个密文，那么你一定知道这个加密信息的人就是拥有这把公钥对应私钥的人（公私钥是成对出现。通俗点讲：如果B用A的公钥解开一个密文，那么这段密文一定是A发送的）。这样一个第三方的机构（证书颁发机构），用自己私钥加密某些信息（csr）然后把公钥公开给大家，如果你能用这个机构的公钥打开这个信息，那么就代表这个信息是这个机构承认的。这就是CA。

> 简便的记忆理解方式：既然是加密，那肯定是不希望别人知道我的消息，所以只有我才能解密，所以可得出**公钥加密，私钥解密**；同理，既然是签名，那肯定是不希望有人冒充我发消息，只有我才能发布这个签名，所以可得出**私钥负责签名，公钥负责验证**。

### 3、HTTPS是使用的非对称加密吗？

是非对称加密和对称加密结合的方式。

HTTPS是使用SSL/TLS加密方式，其实客户端(C)和服务端(S)是用非对称加密获得`会话密钥`，然后C和S一起用这个`会话密钥`进行对称加密。

> Q1：为什么要先用非对称再用对称呢？直接一直用非对称不好吗？
>
> A1：因为非对称加密开销较大（这个**开销主要在算法运算**上，非对称加密算法比对称加密算法慢数千倍。比如RSA是基于两个大质数相乘得到的大数难以被因式分解，运算量很大）。
>
> Q2：那为什么不直接用对称加密？
>
> A2：在保护通信安全方面，非对称加密算法具有对称密码难以企及的优势。
>
> Q3：通常有哪些对称加密方法？非对称加密方法？（应该不会这么问，当个常识吧）
>
> A3：对称加密算法比如DES，AES，非对称加密算法比如RSA。
>
> 不错的回答：
>
> 安全肯定是非对称加密安全，但是效率比较慢，对称加密效率高，但是不安全。**严谨一点的做法是混合起来使用，将对称加密的密钥使用非对称加密的公钥进行加密，然后发送出去，接收方使用私钥进行解密得到对称加密的密钥，然后双方可以使用对称加密来进行沟通。（也就是HTTPS加密方式的核心思路，SSL/TLS协议）**实际工作中直接使用非对称加、解密其实也可以，因为我们平时一般请求的报文不会很大，加解密起来速度在可接受范围内，或者可以对敏感字段，比如密码、手机号、身份证号等进行分段加密，效率还可以。

### 4、HTTPS建立连接的详细过程

> 参考：https://www.cnblogs.com/liyuhui-Z/p/7844880.html

- 发起请求
  - 当客户在浏览器中输入网址的并且按下回车
- 地址解析，获取IP
  - 浏览器会在浏览器DNS缓存,本地DNS缓存,和Hosts中寻找对应的记录
  - 如果没有获取到则会请求DNS服务来获取对应的IP地址。
- 建立TCP连接
  - 三次握手，建立TCP连接，这是网络层的连接（只是IP之间可以通信了，还没精确到端口）
  - 三次握手详细过程略
- 建立连接
  - 如果是HTTP连接则直接可以数据通信了。（当然，防火墙那边端口要打开）
  - 如果是建立HTTPS连接，则需要SSL/TLS协议一套操作，使得双方都得到了相同的会话密钥，进行对称密钥加密通信。
- 进行通信
  - 1、客户端发送请求包。
  - 2、服务端接受请求并做出响应给客户端。
  - 3、浏览器渲染数据展示页面。

